<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã€éå…¬å¼ã€‘ DBSDV ã‚«ãƒ¼ãƒ‰æ¤œç´¢</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
  font-family: "Poppins", "Noto Sans JP", sans-serif;
  background: #f6f9fc;
  color: #333;
  text-align: center;
  margin: 0;
  padding: 20px;
}
h1 {
  font-size: 30px;
  color: #444;
  margin-bottom: 25px;
  font-weight: 800;
}
#filter {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 12px;
  background: rgba(255,255,255,0.8);
  backdrop-filter: blur(10px);
  border-radius: 20px;
  padding: 18px 22px;
  box-shadow: 0 8px 25px rgba(0,0,0,0.08);
  margin-bottom: 25px;
}
label { font-size: 14px; color: #444; }
select, input[type="text"] {
  padding: 6px 8px;
  font-size: 14px;
  border: 1px solid #ccc;
  border-radius: 8px;
  background: #f9f9fc;
  transition: 0.2s;
}
select:focus, input[type="text"]:focus {
  outline: none;
  border-color: #6ca0dc;
  box-shadow: 0 0 5px rgba(108,160,220,0.3);
}
#searchBtn, #clearBtn {
  padding: 8px 18px;
  font-size: 15px;
  border: none;
  border-radius: 10px;
  font-weight: 700;
  cursor: pointer;
  transition: 0.25s ease;
}
#searchBtn {
  background: linear-gradient(135deg, #ffe6ef, #ffd8e6);
  color: #333;
  box-shadow: 0 3px 8px rgba(255,170,190,0.25);
}
#clearBtn {
  background: linear-gradient(135deg, #e6f3ff, #d7ebff);
  color: #333;
  box-shadow: 0 3px 8px rgba(150,180,255,0.25);
}
#searchBtn:hover, #clearBtn:hover { transform: scale(1.05); }
#cardContainer {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  max-width: 1300px;
  margin: auto;
}
.card {
  width: 260px;
  margin: 12px;
  padding: 14px;
  border-radius: 16px;
  background: rgba(255,255,255,0.7);
  border: 1px solid rgba(240,240,240,0.9);
  backdrop-filter: blur(8px);
  text-align: left;
  transition: transform 0.25s ease, box-shadow 0.3s ease;
  box-shadow: 0 4px 14px rgba(0,0,0,0.08);
}
.card:hover {
  transform: translateY(-6px) scale(1.03);
  box-shadow: 0 10px 25px rgba(0,0,0,0.15);
}
.card strong {
  display: block;
  font-size: 17px;
  font-weight: 700;
  color: #333;
  margin-bottom: 8px;
}
.meta small {
  display: block;
  font-size: 13px;
  line-height: 1.5;
  color: #333;
}
mark {
  background: #cce5ff;
  padding: 0 2px;
  border-radius: 3px;
}
.no-results {
  width: 100%;
  text-align: center;
  color: #777;
  padding: 20px;
}
#disclaimer {
  margin-top: 40px;
  padding: 20px 12px;
  background: rgba(255,255,255,0.75);
  border-top: 1px solid #e6e6e6;
  color: #666;
  font-size: 12px;
}
.ãƒ©ãƒƒã‚·ãƒ¥   { background-color: #fff8e1; }   /* è–„ã„é»„è‰² */
.ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ { background-color: #e9f4ff; }   /* è–„ã„é’ */
.ãƒ–ãƒ¼ã‚¹ãƒˆ   { background-color: #e8ffe8; }   /* è–„ã„ç·‘ */
.ãƒªãƒŸãƒ†ãƒƒãƒ‰ { background-color: #f4f4f4; }   /* ã‚°ãƒ¬ãƒ¼ */

</style>
</head>
<body>

<h1>ã€éå…¬å¼ã€‘ DBSDV ã‚«ãƒ¼ãƒ‰æ¤œç´¢</h1>

<!-- ğŸ”¹ ã“ã“ã«æˆ¦é—˜åŠ›è¨ˆç®—ã¸ã®ãƒªãƒ³ã‚¯ãƒœã‚¿ãƒ³ã‚’è¿½åŠ  -->
<p>
<a href="battle.html" class="cute-blue-link">æˆ¦é—˜åŠ›è¨ˆç®—ã¸ â†’</a>
<a href="level.html" class="cute-blue-link">å¸«å¼Ÿãƒªã‚¹ãƒˆã¸ â†’</a>
</p>
  
<style>
.cute-blue-link {
  display: inline-block;
  background-color: #e3f2fd; /* æ·¡ã„ã‚¹ã‚«ã‚¤ãƒ–ãƒ«ãƒ¼ */
  color: #1976d2; /* æ¿ƒã„é’æ–‡å­— */
  padding: 8px 18px;
  border-radius: 25px;
  text-decoration: none;
  font-weight: 600;
  transition: 0.25s;
  box-shadow: 0 2px 6px rgba(33, 150, 243, 0.25);
}

.cute-blue-link:hover {
  background-color: #bbdefb; /* å°‘ã—æ¿ƒã */
  color: #fff; /* ç™½æ–‡å­— */
  box-shadow: 0 3px 10px rgba(33, 150, 243, 0.4);
  transform: scale(1.05);
}
</style>


<div id="filter">
  <label>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰:
    <input type="text" id="keyword" placeholder="åå‰ãƒ»ã‚¹ã‚­ãƒ«ãƒ»ç•ªå·ãªã©">
  </label>
  <label>
    <input type="checkbox" id="nameOnly">
    ã‚«ãƒ¼ãƒ‰åã®ã¿
  </label>
  <label>åéŒ²å¼¾:
    <select id="series">
      <option value="">å…¨ã¦</option>
      <option value="0">ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ</option>
      <option value="1">1å¼¾</option>
      <option value="2">2å¼¾</option>
      <option value="3">3å¼¾</option>
      <option value="4">4å¼¾</option>
      <option value="5">5å¼¾</option>
      <option value="6">6å¼¾</option>
      <option value="7">7å¼¾</option>
      <option value="PR">ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³</option>
    </select>
  </label>
  <label>ãƒ¬ã‚¢ãƒªãƒ†ã‚£:
    <select id="rarity">
      <option value="">å…¨ã¦</option>
      <option value="N">N</option>
      <option value="R">R</option>
      <option value="SR">SR</option>
      <option value="GDR">GDR</option>
      <option value="PUR">PUR</option>
      <option value="SEC">SEC</option>
      <option value="EXR">EXR</option>
      <option value="PR">PR</option>
    </select>
  </label>
  <label>ãƒãƒˆãƒ«ã‚¿ã‚¤ãƒ—:
    <select id="battleType">
      <option value="">å…¨ã¦</option>
      <option value="ãƒ©ãƒƒã‚·ãƒ¥">ãƒ©ãƒƒã‚·ãƒ¥</option>
      <option value="ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ">ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ</option>
      <option value="ãƒ–ãƒ¼ã‚¹ãƒˆ">ãƒ–ãƒ¼ã‚¹ãƒˆ</option>
      <option value="ãƒªãƒŸãƒ†ãƒƒãƒ‰">ãƒªãƒŸãƒ†ãƒƒãƒ‰</option>
    </select>
  </label>
  <label>æ”»æ’ƒã‚¹ã‚¿ã‚¤ãƒ«:
    <select id="attackStyle">
      <option value="">å…¨ã¦</option>
      <option value="æ‰“æ’ƒ">æ‰“æ’ƒ</option>
      <option value="æ°—å¼¾">æ°—å¼¾</option>
    </select>
  </label>
  <label>å¤‰èº«çŠ¶æ…‹:
    <input type="text" id="transform" placeholder="ä¾‹: é€šå¸¸">
  </label>
  <label>å¤‰èº«çŠ¶æ…‹ï¼ˆè¦šé†’å¾Œï¼‰:
    <input type="text" id="transform2" placeholder="ä¾‹: è¶…ã‚µã‚¤ãƒ¤äºº">
  </label>

 
   <div class="filter-row">
     <label>æ°—åŠ›:
    <select id="ki">
      <option value="">å…¨ã¦</option>
      <option value="2">2ä»¥ä¸Š</option>
      <option value="3">3ä»¥ä¸Š</option>
    </select>
  </label>
  <label>ã‚¨ãƒŠã‚¸ãƒ¼:
    <select id="energy">
      <option value="">å…¨ã¦</option>
      <option value="4">4</option>
      <option value="5">5</option>
      <option value="6">6</option>
      <option value="7">7</option>
      <option value="8">8</option>
      <option value="9">9</option>
      <option value="10">10</option>
      <option value="11">11</option>
      <option value="12">12</option>
    </select>
  </label>
  
  </div>
    <button id="searchBtn">æ¤œç´¢</button>
    <button id="clearBtn">ã‚¯ãƒªã‚¢</button>
  </div>

<p id="count" style="color:#666;margin-bottom:10px;font-size:14px;">è¡¨ç¤ºä¸­: 0æš</p>
<div id="cardContainer">èª­ã¿è¾¼ã¿ä¸­â€¦</div>

<footer id="disclaimer">
  æœ¬ã‚µã‚¤ãƒˆã¯ãƒ•ã‚¡ãƒ³ã«ã‚ˆã‚‹éå…¬å¼ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚<br>
  ã€Œãƒ‰ãƒ©ã‚´ãƒ³ãƒœãƒ¼ãƒ« ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ€ã‚¤ãƒãƒ¼ã‚ºã€ãŠã‚ˆã³é–¢é€£åç§°ã¯å„æ¨©åˆ©è€…ã«å¸°å±ã—ã¾ã™ã€‚
</footer>

<!-- å„å¼¾ã®ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ -->
<script src="cardtest.js"></script>
<script src="card1.js"></script>
<script src="card2.js"></script>
<script src="card3.js"></script>
<script src="card4.js"></script>
<script src="card5.js"></script>
<script src="card6.js"></script>
<script src="card7.js"></script>
<script src="cardpr.js"></script>
<script>
let allCardsData = [];

window.onload = () => {
  // å…¨ã‚«ãƒ¼ãƒ‰çµ±åˆ
  allCardsData = []
    .concat(
      (typeof cardDatatest!=="undefined"?cardDatatest:[]),
      (typeof cardData1!=="undefined"?cardData1:[]),
      (typeof cardData2!=="undefined"?cardData2:[]),
      (typeof cardData3!=="undefined"?cardData3:[]),
      (typeof cardData4!=="undefined"?cardData4:[]),
      (typeof cardData5!=="undefined"?cardData5:[]),
      (typeof cardData6!=="undefined"?cardData6:[]),
      (typeof cardData7!=="undefined"?cardData7:[]),
      (typeof cardDatapr!=="undefined"?cardDatapr:[])
    );
  displayCards(allCardsData);
  document.getElementById("searchBtn").onclick = applyFilters;
  document.getElementById("clearBtn").onclick = clearFilters;
  document.addEventListener("keydown", e => { if(e.key==="Enter") applyFilters(); });
};

// å¼¾æ•°åˆ¤å®š
function getSeriesNumber(cardNo){
  if(!cardNo) return null;
  const s = cardNo.toUpperCase();
  if(s.startsWith("TEST")) return 0;
  if(s.startsWith("SDV1")||s.startsWith("EX1")) return 1;
  if(s.startsWith("SDV2")||s.startsWith("EX2")) return 2;
  if(s.startsWith("SDV3")||s.startsWith("EX3")) return 3;
  if(s.startsWith("SDV4")||s.startsWith("EX4")) return 4;
  if(s.startsWith("SDV5")||s.startsWith("EX5")) return 5;
  if(s.startsWith("SDV6")||s.startsWith("EX6")) return 6;
  if(s.startsWith("SDV7")||s.startsWith("EX7")) return 7;
  if(s.startsWith("SDVP")||s.startsWith("SDVE")||s.startsWith("SDVF")||s.startsWith("AP")||s.startsWith("SDVBS")||s.startsWith("SDVSV")||s.startsWith("SDVPJ")||s.startsWith("SDVTP")||s.startsWith("AP2")||s.startsWith("SDVBS")||s.startsWith("SDVZV")||s.startsWith("SDVTD")||s.startsWith("SDVTB")) return "PR";
  return null;
}

function highlightText(text, keyword) {
  if (!text) return "";
  if (!keyword || keyword.trim().length < 1) return text;

  // è¤‡æ•°ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å¯¾å¿œï¼ˆã‚¹ãƒšãƒ¼ã‚¹ãƒ»å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ã§åˆ†å‰²ï¼‰
  const keywords = keyword
    .split(/[^\S\u3000]+/)      // åŠè§’/å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ã§åˆ†å‰²
    .map(k => k.trim())
    .filter(k => k.length > 0);

  let result = text;

  keywords.forEach(k => {
    try {
      const escaped = k.replace(/[.*+?^${}()|[\]\\]/g, "\\$&"); // æ­£è¦è¡¨ç¾ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
      const regex   = new RegExp(escaped, "gi");
      result = result.replace(regex, match => `<mark>${match}</mark>`);
    } catch (e) {
      console.error("Regex error:", e);
    }
  });

  return result;   // â† ã“ã®1å€‹ã ã‘ã§OKï¼ˆå¤–ã« return ã‚’æ›¸ã‹ãªã„ï¼‰
}




// ã‚«ãƒ¼ãƒ‰è¡¨ç¤º
function displayCards(cards, keyword=""){
  const container = document.getElementById("cardContainer");
  const count = document.getElementById("count");
  container.innerHTML = "";
  count.textContent = `è¡¨ç¤ºä¸­: ${cards.length}æš`;
  if(!cards.length){
    container.innerHTML = '<div class="no-results">è©²å½“ã™ã‚‹ã‚«ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>';
    return;
  }

  cards.forEach(c=>{
    const div = document.createElement("div");
    div.className = "card " + (c["ãƒãƒˆãƒ«ã‚¿ã‚¤ãƒ—"] || "");
    div.innerHTML = `
      <strong>${highlightText(`${c["ã‚«ãƒ¼ãƒ‰ç•ªå·"]||""} ${c["ã‚«ãƒ¼ãƒ‰å"]||""}`, keyword)}</strong>
      <div class="meta">
         ${Object.entries(c)
      .filter(([k]) => !["URL", "ã‚«ãƒ¼ãƒ‰ç•ªå·", "ã‚«ãƒ¼ãƒ‰å"].includes(k))
      .map(([k,v]) => `<small>${highlightText(`${k}: ${v||"â€”"}`, keyword)}</small>`)
      .join("")}
      </div>`;
    if(c["URL"]) div.onclick = ()=>window.open(c["URL"],"_blank");
    container.appendChild(div);
  });
}

// å…¨è§’åŠè§’ãƒ»å¤§æ–‡å­—å°æ–‡å­—ã‚’ç„¡è¦–ã™ã‚‹ãŸã‚ã®å…±é€šé–¢æ•°ï¼ˆå®‰å…¨ç‰ˆï¼‰
function normalizeText(str) {
  if (str === null || str === undefined) return "";
  // æ•°å€¤ã‚„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚‚å®‰å…¨ã«æ–‡å­—åˆ—åŒ–
  return String(str).normalize("NFKC").toLowerCase();
}


function applyFilters() {
  const kw = normalizeText(document.getElementById("keyword")?.value.trim() || "");
  const series = document.getElementById("series")?.value || "";
  const rarity = document.getElementById("rarity")?.value || "";
  const bt = document.getElementById("battleType")?.value || "";
  const as = document.getElementById("attackStyle")?.value || "";
  const tf1 = normalizeText(document.getElementById("transform")?.value.trim() || "");
  const tf2 = normalizeText(document.getElementById("transform2")?.value.trim() || "");
  const ki = document.getElementById("ki")?.value || "";
  const en = document.getElementById("energy")?.value || "";
  const nameOnly = document.getElementById("nameOnly")?.checked;

  let filtered = allCardsData.filter(c => {
    // ğŸ” ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢
if (kw) {
  // ã‚¹ãƒšãƒ¼ã‚¹ã§åˆ†å‰²ï¼ˆå…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ã‚‚å¯¾å¿œï¼‰
  const keywords = kw.split(/[\s\u3000]+/).filter(k => k);

  if (nameOnly) {
    // ã‚«ãƒ¼ãƒ‰åã ã‘æ¤œç´¢
    const nameText = normalizeText(c["ã‚«ãƒ¼ãƒ‰å"]);
    // å…¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å«ã‚€ã‹åˆ¤å®š
    if (!keywords.every(k => nameText.includes(k))) return false;
  } else {
    // URLãªã©é™¤å¤–ã—ã¦å…¨ä½“æ¤œç´¢
    const values = Object.entries(c)
      .filter(([key]) => !["URL", "ç”»åƒ", "ãƒªãƒ³ã‚¯"].includes(key))
      .map(([_, v]) => normalizeText(v))
      .join(" ");
    
    // ã™ã¹ã¦ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å«ã‚€ã‹åˆ¤å®š
    if (!keywords.every(k => values.includes(k))) return false;
  }
}



    // ğŸ”¹ ä»–ã®æ¡ä»¶
    const cardSeries = getSeriesNumber(c["ã‚«ãƒ¼ãƒ‰ç•ªå·"]);

if (series) {
  if (series === "PR") {
    if (cardSeries !== "PR") return false;
  } else {
    if (cardSeries !== Number(series)) return false;
  }
}
    if (rarity && normalizeText(c["ãƒ¬ã‚¢ãƒªãƒ†ã‚£"]) !== normalizeText(rarity)) return false;
    if (bt && normalizeText(c["ãƒãƒˆãƒ«ã‚¿ã‚¤ãƒ—"]) !== normalizeText(bt)) return false;
    if (as && normalizeText(c["æ”»æ’ƒã‚¹ã‚¿ã‚¤ãƒ«"]) !== normalizeText(as)) return false;
    if (tf1 && !normalizeText(c["å¤‰èº«çŠ¶æ…‹"]).includes(tf1)) return false;
    if (tf2 && !normalizeText(c["å¤‰èº«çŠ¶æ…‹ï¼ˆè¦šé†’å¾Œï¼‰"]).includes(tf2)) return false;

    // âš¡ æ°—åŠ›
    if (ki) {
      const kiRaw = c["æ°—åŠ›"] ? Number(c["æ°—åŠ›"]) : 0;
      const numKi = Number(ki);
      if (!isNaN(numKi) && kiRaw < numKi) return false;
    }

    // âš¡ ã‚¨ãƒŠã‚¸ãƒ¼
if (en) {
  const energyRaw = Number(c["ã‚¨ãƒŠã‚¸ãƒ¼"]) || 0;
  const numEn = Number(en);
  if (!isNaN(numEn) && energyRaw !== numEn) return false;
}

    return true;
  });

  displayCards(filtered, kw);
}



// ã‚¯ãƒªã‚¢å‡¦ç†
function clearFilters(){
  document.querySelectorAll("#filter select, #filter input").forEach(el => el.value = "");
  displayCards(allCardsData);
}
</script>
</body>
</html>
