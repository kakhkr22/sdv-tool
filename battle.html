<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>DBSDV æˆ¦é—˜åŠ›è¨ˆç®—</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
/* ===== ãƒ™ãƒ¼ã‚¹ ===== */
body {
  font-family: "Poppins", "Noto Sans JP", sans-serif;
  background: #f6f9fc;
  color: #333;
  text-align: center;
  margin: 0;
  padding: 20px;
}
h1 {
  font-size: 30px;
  color: #444;
  margin-bottom: 25px;
  font-weight: 800;
}

/* ===== ä¸Šæ®µï¼šã‚¢ãƒã‚¿ãƒ¼ï¼‹çµæœ ===== */
.top-grid {
  display: flex;
  justify-content: center;
  align-items: stretch;
  gap: 20px;
  flex-wrap: wrap;
  margin-bottom: 24px;
}
.card-select, .result-box {
  width: 280px;
  padding: 12px;
  border-radius: 14px;
  background: #fff;
  box-shadow: 0 2px 8px rgba(0,0,0,.08);
}
.card-select h4 {
  font-size: 14px;
  color: #444;
  margin: 4px 0 8px;
}
#avatar { text-align: center; }

/* å…¥åŠ›ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆè§’ä¸¸ãƒ»çµ±ä¸€ï¼‰ */
select, input[type="text"], input[type="number"] {
  width: 80%;
  margin: 6px auto;
  display: block;
  padding: 6px 7px;
  font-size: 13px;
  border: 1px solid #ccc;
  border-radius: 8px;
  box-sizing: border-box;
  text-align: center;
}
.hp-input { width: 56%; }

/* çµæœãƒœãƒƒã‚¯ã‚¹ */
.result-box {
  text-align: left;
}
#resultPower, #resultHP {
  font-size: 20px;
  font-weight: 800;
  margin: 6px 0;
}
#resultPower { color: #0a5aa5; }
#resultHP    { color: #0a7a55; }
#breakdownTitle {
  margin: 10px 0 6px;
  font-weight: 700;
  color: #555;
  border-top: 1px dashed #ddd;
  padding-top: 8px;
}
#breakdown {
  font-size: 13px;
  line-height: 1.6;
  color: #333;
  white-space: pre-line; /* æ”¹è¡Œç¶­æŒ */
}

/* ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆé‡è¤‡ï¼‰ */
#errorMsg {
  color: #d33;
  font-weight: 700;
  font-size: 13px;
  margin-bottom: 6px;
}

/* ===== ä¸‹æ®µï¼šã‚«ãƒ¼ãƒ‰é¸æŠ 4 + 3 ===== */
.card-grid {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 10px;
  margin-bottom: 16px;
}
.card-box {
  width: 260px;
  padding: 12px;
  border-radius: 14px;
  background: #fff;
  box-shadow: 0 2px 8px rgba(0,0,0,.08);
  transition: box-shadow .2s ease, border .2s ease;
  text-align: center;
}
.card-box h4 {
  font-size: 14px;
  margin: 0 0 8px;
  color: #444;
}
.card-box label {
  display: block;
  font-size: 12px;
  color: #555;
  margin-top: 4px;
}
.status, .power {
  font-size: 12px;
  color: #555;
}
.power { font-weight: 700; color: #0a5aa5; }

/* é‡è¤‡å¼·èª¿ */
.duplicate { border: 2px solid #ff4d4d; }

/* ãƒãƒˆãƒ«ã‚¿ã‚¤ãƒ—èƒŒæ™¯ï¼ˆã‚«ãƒ¼ãƒ‰é¸æŠã¨ã‚¢ãƒã‚¿ãƒ¼ï¼‰ */
.bg-ãƒ©ãƒƒã‚·ãƒ¥   { background-color: #fff8e1; }
.bg-ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ { background-color: #e9f4ff; }
.bg-ãƒ–ãƒ¼ã‚¹ãƒˆ   { background-color: #e8ffe8; }
.bg-ãƒªãƒŸãƒ†ãƒƒãƒ‰ { background-color: #f4f4f4; }

@media (max-width: 720px){
  .card-select, .result-box { width: 100%; max-width: 360px; }
  .card-box { width: 100%; max-width: 320px; }
}
</style>
</head>
<body>

<h1>DBSDV æˆ¦é—˜åŠ›è¨ˆç®—</h1>

<!-- ğŸ”¹ ã“ã“ã«ãƒãƒˆãƒ«è¨ˆç®—ãƒ„ãƒ¼ãƒ«ã¸ã®ãƒªãƒ³ã‚¯ãƒœã‚¿ãƒ³ã‚’è¿½åŠ  -->
<p>
<a href="index.html" class="cute-blue-link">â† ã‚«ãƒ¼ãƒ‰æ¤œç´¢ã¸</a>
<a href="level.html" class="cute-blue-link">å¸«å¼Ÿãƒªã‚¹ãƒˆã¸ â†’</a>
</p>

<style>
.cute-blue-link {
  display: inline-block;
  background-color: #e3f2fd; /* æ·¡ã„ã‚¹ã‚«ã‚¤ãƒ–ãƒ«ãƒ¼ */
  color: #1976d2; /* æ¿ƒã„é’æ–‡å­— */
  padding: 8px 18px;
  border-radius: 25px;
  text-decoration: none;
  font-weight: 600;
  transition: 0.25s;
  box-shadow: 0 2px 6px rgba(33, 150, 243, 0.25);
}

.cute-blue-link:hover {
  background-color: #bbdefb; /* å°‘ã—æ¿ƒã */
  color: #fff; /* ç™½æ–‡å­— */
  box-shadow: 0 3px 10px rgba(33, 150, 243, 0.4);
  transform: scale(1.05);
}
</style>

</p>
<style>
.cute-title {
  font-family: "Poppins", "Noto Sans JP", sans-serif;
  color: #ff69b4; /* ãƒ”ãƒ³ã‚¯ */
  background: #fff0f5; /* è–„ã„ãƒ”ãƒ³ã‚¯èƒŒæ™¯ */
  display: inline-block;
  padding: 12px 25px;
  border-radius: 25px;
  box-shadow: 0 3px 8px rgba(255, 182, 193, 0.4);
  font-size: 26px;
  font-weight: 600;
  letter-spacing: 1px;
  text-shadow: 1px 1px 3px rgba(255,255,255,0.8);
  margin-bottom: 20px;
}
</style>

<div class="top-grid">
  <!-- ã‚¢ãƒã‚¿ãƒ¼ -->
  <div id="avatar" class="card-select bg-ãƒ©ãƒƒã‚·ãƒ¥">
    <h4>ã‚¢ãƒã‚¿ãƒ¼</h4>
    <label>HP</label>
    <input type="number" id="avatarHP" class="hp-input" min="0" max="9999" placeholder="0000" oninput="calcPower()">
    <label>æ°—åŠ›</label>
    <select id="avatarKi" onchange="calcPower()">
      <option value="1">1.0</option>
      <option value="1.2">1.2</option>
      <option value="1.4">1.4</option>
      <option value="1.6">1.6</option>
      <option value="1.8">1.8</option>
      <option value="2">2.0</option>
    </select>
    <label>ã‚¿ã‚¤ãƒ—</label>
    <select id="avatarType" onchange="changeBg(this.value,'avatar'); calcPower();">
      <option value="ãƒ©ãƒƒã‚·ãƒ¥">ãƒ©ãƒƒã‚·ãƒ¥</option>
      <option value="ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ">ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ</option>
      <option value="ãƒ–ãƒ¼ã‚¹ãƒˆ">ãƒ–ãƒ¼ã‚¹ãƒˆ</option>
      <option value="ãƒªãƒŸãƒ†ãƒƒãƒ‰">ãƒªãƒŸãƒ†ãƒƒãƒ‰</option>
    </select>
    <div id="avatarPower" class="power" style="margin-top:6px;">æˆ¦é—˜åŠ›: 0</div>
  </div>

  <!-- åˆè¨ˆçµæœï¼†å†…è¨³ -->
  <div class="result-box">
    <div id="errorMsg"></div>
    <div id="resultPower">åˆè¨ˆæˆ¦é—˜åŠ›: 0</div>
    <div id="resultHP">åˆè¨ˆHP: 0</div>
    <div id="breakdownTitle">å†…è¨³</div>
    <div id="breakdown">ã‚¢ãƒã‚¿ãƒ¼: æˆ¦é—˜åŠ› 0 ï¼ HP 0</div>
  </div>
</div>

<!-- 2æ®µç›®ï¼ˆ4æšï¼‰ -->
<div id="row1" class="card-grid"></div>
<!-- 3æ®µç›®ï¼ˆ3æšï¼‰ -->
<div id="row2" class="card-grid"></div>

<script>
/* ===== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ===== */
function getSeriesNumber(cardNo){
  if(!cardNo) return null;
  const s = cardNo.toUpperCase();
  if(s.startsWith("TEST")) return 0;
  if(s.startsWith("SDV1")||s.startsWith("EX1")) return 1;
  if(s.startsWith("SDV2")||s.startsWith("EX2")) return 2;
  if(s.startsWith("SDV3")||s.startsWith("EX3")) return 3;
  if(s.startsWith("SDV4")||s.startsWith("EX4")) return 4;
  if(s.startsWith("SDV5")||s.startsWith("EX5")) return 5;
  if(s.startsWith("SDV6")||s.startsWith("EX6")) return 6;
  if(s.startsWith("SDV7")||s.startsWith("EX7")) return 7;
  if(s.startsWith("SDVP")||s.startsWith("SDVE")||s.startsWith("SDVF")||s.startsWith("AP")||s.startsWith("SDVBS")||s.startsWith("SDVSV")||s.startsWith("SDVPJ")||s.startsWith("SDVTP")||s.startsWith("AP2")||s.startsWith("SDVBS")||s.startsWith("SDVTD")||s.startsWith("SDVZV")||s.startsWith("SDVTB")) return "PR";
  return null;
}
function changeBg(type, id){
  const el = document.getElementById(id);
  el.className = el.className.replace(/\bbg-\S+/g, '').trim(); // æ—¢å­˜bg-ã‚¯ãƒ©ã‚¹ã‚’é™¤å»
  el.classList.add(`bg-${type}`);
}

/* ===== åˆæœŸé…ç½®ï¼ˆã‚«ãƒ¼ãƒ‰é¸æŠ 7æšï¼‰===== */
function createSelects(){
  const row1 = document.getElementById("row1");
  const row2 = document.getElementById("row2");
  row1.innerHTML = ""; row2.innerHTML = "";
  for(let i=1;i<=7;i++){
    const box = document.createElement("div");
    box.className = "card-box";
    box.id = `cardDiv${i}`;
    box.innerHTML = `
      <h4 id="cardTitle${i}">ã‚«ãƒ¼ãƒ‰${i}</h4>

      <label>åéŒ²å¼¾:
         <select id="series${i}" onchange="updateCardOptions(${i})">
          <option value="">å…¨ã¦</option>
          <option value="0">ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ</option>
          <option value="1">1å¼¾</option>
          <option value="2">2å¼¾</option>
          <option value="3">3å¼¾</option>
          <option value="4">4å¼¾</option>
          <option value="5">5å¼¾</option>
          <option value="6">6å¼¾</option>
          <option value="7">7å¼¾</option>
          <option value="PR">ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³</option>
        </select>
      </label>

      <label>ãƒãƒˆãƒ«ã‚¿ã‚¤ãƒ—</label>
      <select id="type${i}" onchange="updateCardOptions(${i})">
        <option value="">å…¨ã¦</option>
        ${["ãƒ©ãƒƒã‚·ãƒ¥","ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ","ãƒ–ãƒ¼ã‚¹ãƒˆ","ãƒªãƒŸãƒ†ãƒƒãƒ‰"].map(t=>`<option value="${t}">${t}</option>`).join('')}
      </select>

      <label>ã‚«ãƒ¼ãƒ‰åï¼ç•ªå· æ¤œç´¢</label>
      <input type="text" id="search${i}" placeholder="ä¾‹ï¼šå­«æ‚Ÿç©º, SDV1-001" oninput="filterByName(${i})">

      <label>ã‚«ãƒ¼ãƒ‰ã‚’é¸æŠ</label>
      <select id="card${i}" onchange="updateCardStatus(${i})">
        <option value="">ã‚«ãƒ¼ãƒ‰ã‚’é¸æŠ</option>
      </select>

      <div id="status${i}" class="status"></div>
      <div id="power${i}" class="power"></div>
    `;
    (i<=4 ? row1 : row2).appendChild(box);
    updateCardOptions(i);
  }
}

/* ===== ã‚«ãƒ¼ãƒ‰å€™è£œã®æ›´æ–°ï¼†æ¤œç´¢ ===== */
function updateCardOptions(i){
  const s = document.getElementById(`series${i}`).value;
  const t = document.getElementById(`type${i}`).value;
  const select = document.getElementById(`card${i}`);
  const keyword = (document.getElementById(`search${i}`).value||"").trim().toLowerCase();

  let filtered = allCardsData.filter(c=>{
    const sn = getSeriesNumber(c["ã‚«ãƒ¼ãƒ‰ç•ªå·"]);
    if(s && sn != s) return false; 
    if(t && c["ãƒãƒˆãƒ«ã‚¿ã‚¤ãƒ—"] !== t) return false;
    if(keyword){
      const k = keyword;
      const nm = (c["ã‚«ãƒ¼ãƒ‰å"]||"").toLowerCase().includes(k);
      const no = (c["ã‚«ãƒ¼ãƒ‰ç•ªå·"]||"").toLowerCase().includes(k);
      if(!nm && !no) return false;
    }
    return true;
  });

  select.innerHTML = '<option value="">ã‚«ãƒ¼ãƒ‰ã‚’é¸æŠ</option>' +
    filtered.map(c => `
      <option value="${c["ã‚«ãƒ¼ãƒ‰ç•ªå·"]}"
              data-name="${c["ã‚«ãƒ¼ãƒ‰å"]||""}"
              data-ki="${c["æ°—åŠ›"]||0}"
              data-type="${c["ãƒãƒˆãƒ«ã‚¿ã‚¤ãƒ—"]||""}"
              data-hp="${c["HP"]||0}">
        ${c["ã‚«ãƒ¼ãƒ‰ç•ªå·"]||""} ${c["ã‚«ãƒ¼ãƒ‰å"]||""}
      </option>
    `).join("");

  // é¸æŠç¶­æŒï¼ˆåŒã˜å€¤ãŒãƒªã‚¹ãƒˆã«ã‚ã‚Œã°æ®‹ã™ï¼‰
  const prev = select.getAttribute("data-prev");
  if(prev){
    const opt = [...select.options].find(o=>o.value===prev);
    if(opt) select.value = prev;
  }
  // çŠ¶æ…‹æ›´æ–°
  updateCardStatus(i, /*noRecalc*/ true);
  calcPower();
}
function filterByName(i){ updateCardOptions(i); }

/* ===== é¸æŠçŠ¶æ…‹ã®åæ˜ ï¼ˆèƒŒæ™¯ãƒ»è¡¨ç¤ºãƒ»é‡è¤‡ãƒã‚§ãƒƒã‚¯é€£æºï¼‰ ===== */
function updateCardStatus(i, noRecalc=false){
  const sel = document.getElementById(`card${i}`);
  const title = document.getElementById(`cardTitle${i}`);
  const box = document.getElementById(`cardDiv${i}`);
  const status = document.getElementById(`status${i}`);
  const power  = document.getElementById(`power${i}`);

  // é¸æŠå€¤ã‚’è¨˜æ†¶ï¼ˆãƒ•ã‚£ãƒ«ã‚¿æ›´æ–°æ™‚ã®ç¶­æŒç”¨ï¼‰
  sel.setAttribute("data-prev", sel.value || "");

  if(!sel.value){
    title.textContent = `ã‚«ãƒ¼ãƒ‰${i}`;
    status.textContent = "";
    power.textContent  = "";
    box.className = "card-box";
    if(!noRecalc){ checkDuplicates(); calcPower(); }
    return;
  }
  const opt  = sel.selectedOptions[0];
  const name = opt.dataset.name || `ã‚«ãƒ¼ãƒ‰${i}`;
  const type = opt.dataset.type || "";
  const ki   = parseFloat(opt.dataset.ki || 0);
  const hp   = parseInt(opt.dataset.hp || 0);

  title.textContent = name;
  // èƒŒæ™¯ï¼ˆã‚¿ã‚¤ãƒ—ï¼‰
  box.className = "card-box";
  box.classList.add(`bg-${type}`);

  status.textContent = `HP: ${hp} ï¼ æ°—åŠ›: ${ki}`;
  let p = ki * 2500;
  if(type === "ãƒ–ãƒ¼ã‚¹ãƒˆ") p *= 1.5;
  power.textContent = `æˆ¦é—˜åŠ›: ${Math.round(p)}`;

  if(!noRecalc){ checkDuplicates(); calcPower(); }
}

/* ===== é‡è¤‡å¼·èª¿ï¼ˆèµ¤æ ï¼‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰ ===== */
function checkDuplicates(){
  const seen = new Map(); // ç•ªå· => [i...]
  for(let i=1;i<=7;i++){
    const sel = document.getElementById(`card${i}`);
    const box = document.getElementById(`cardDiv${i}`);
    box.classList.remove("duplicate");
    if(sel.value){
      if(!seen.has(sel.value)) seen.set(sel.value, []);
      seen.get(sel.value).push(i);
    }
  }
  let dup = false;
  for(const [_, idxs] of seen){
    if(idxs.length > 1){
      dup = true;
      idxs.forEach(i => document.getElementById(`cardDiv${i}`).classList.add("duplicate"));
    }
  }
  document.getElementById("errorMsg").textContent = dup ? "âš  åŒã˜ã‚«ãƒ¼ãƒ‰ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã™ã€‚åˆ¥ã®ã‚«ãƒ¼ãƒ‰ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚" : "";
}

/* ===== åˆè¨ˆè¨ˆç®—ï¼‹å†…è¨³ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ãƒ†ã‚­ã‚¹ãƒˆï¼‰ ===== */
function calcPower(){
  let totalPower = 0;
  let totalHP    = 0;
  const lines = [];

  // ã‚¢ãƒã‚¿ãƒ¼
  const aKi   = parseFloat(document.getElementById("avatarKi").value) || 0;
  const aType = document.getElementById("avatarType").value;
  const aHP   = parseInt(document.getElementById("avatarHP").value) || 0;
  let aPow = aKi * 2500;
  if(aType === "ãƒ–ãƒ¼ã‚¹ãƒˆ") aPow *= 1.5;
  totalPower += aPow; totalHP += aHP;
  document.getElementById("avatarPower").textContent = `æˆ¦é—˜åŠ›: ${Math.round(aPow)}`;
  lines.push(`ã‚¢ãƒã‚¿ãƒ¼ï¼ˆ${aType}ï¼‰: æˆ¦é—˜åŠ› ${Math.round(aPow)} ï¼ HP ${aHP}`);

  // 7æš
  for(let i=1;i<=7;i++){
    const sel = document.getElementById(`card${i}`);
    if(!sel || !sel.value) continue;
    const opt  = sel.selectedOptions[0];
    const name = opt.dataset.name || `ã‚«ãƒ¼ãƒ‰${i}`;
    const type = opt.dataset.type || "";
    const ki   = parseFloat(opt.dataset.ki || 0);
    const hp   = parseInt(opt.dataset.hp || 0);

    let pow = ki * 2500;
    if(type === "ãƒ–ãƒ¼ã‚¹ãƒˆ") pow *= 1.5;

    totalPower += pow;
    totalHP    += hp;

    lines.push(`${name}ï¼ˆ${type}ï¼‰: æˆ¦é—˜åŠ› ${Math.round(pow)} ï¼ HP ${hp}`);
  }

  // åæ˜ 
  document.getElementById("resultPower").textContent = `åˆè¨ˆæˆ¦é—˜åŠ›: ${Math.round(totalPower)}`;
  document.getElementById("resultHP").textContent    = `åˆè¨ˆHP: ${Math.round(totalHP)}`;
  document.getElementById("breakdown").textContent   = lines.join("\n");
}

/* ===== èµ·å‹• ===== */
window.onload = () => { createSelects(); calcPower(); };
</script>
<!-- ===== ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿èª­è¾¼é †ã‚’ä¿®æ­£ ===== -->
<script src="cardtest.js"></script>
<script src="card1.js"></script>
<script src="card2.js"></script>
<script src="card3.js"></script>
<script src="card4.js"></script>
<script src="card5.js"></script>
<script src="card6.js"></script>
<script src="card7.js"></script>
<script src="cardpr.js"></script>
<script>
  const allCardsData = [
    ...(typeof cardDatatest !== 'undefined'? cardDatatest : []),
    ...(typeof cardData1 !== 'undefined' ? cardData1 : []),
    ...(typeof cardData2 !== 'undefined' ? cardData2 : []),
    ...(typeof cardData3 !== 'undefined' ? cardData3 : []),
    ...(typeof cardData4 !== 'undefined' ? cardData4 : []),
    ...(typeof cardData5 !== 'undefined' ? cardData5 : []),
    ...(typeof cardData6 !== 'undefined' ? cardData6 : []),
    ...(typeof cardData7 !== 'undefined' ? cardData7 : []),
    ...(typeof cardDatapr !== 'undefined'? cardDatapr : [])
  ];
  window.allCardsData = allCardsData;
</script>

</body>
</html>

